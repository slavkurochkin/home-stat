---
description: Testing workflow rules for Playwright e2e tests
globs: 
alwaysApply: true
---

# Home Stat Project - Cursor Rules

## Project Overview
This is a home utility management application with:
- React frontend (Vite, MUI)
- Microservices backend (Node.js/Express)
- PostgreSQL database
- Docker Compose for orchestration

## Testing Requirements

### Playwright E2E Tests
After completing any feature implementation or bug fix, you MUST:

1. **Ask about adding Playwright tests**: Once a feature or task is completed, always ask the user:
   > "Would you like me to add Playwright e2e tests for this feature?"
   
   If yes, create tests in `/frontend/tests/` directory following this pattern:
   - Test file naming: `[feature-name].spec.ts`
   - **ALWAYS use Page Object Model pattern**
   - Include happy path and error scenarios
   - Test user-visible behavior, not implementation details

2. **Ask about running tests**: After tests are written (or if tests already exist), ask:
   > "Would you like me to run the Playwright tests now?"
   
   If yes, run `npx playwright test` in the frontend directory.

### Page Object Model (REQUIRED)

**ALWAYS** use Page Object Model when creating Playwright tests. This is mandatory, not optional.

#### Page Object Structure
Create page objects in `/frontend/tests/pages/` directory:

```typescript
// /frontend/tests/pages/LoginPage.ts
import { Page, Locator } from '@playwright/test';

export class LoginPage {
  readonly page: Page;
  readonly emailInput: Locator;
  readonly passwordInput: Locator;
  readonly signInButton: Locator;
  readonly errorAlert: Locator;

  constructor(page: Page) {
    this.page = page;
    this.emailInput = page.getByLabel('Email Address');
    this.passwordInput = page.getByLabel('Password');
    this.signInButton = page.getByRole('button', { name: /sign in/i });
    this.errorAlert = page.getByRole('alert');
  }

  async goto() {
    await this.page.goto('/login');
  }

  async login(email: string, password: string) {
    await this.emailInput.fill(email);
    await this.passwordInput.fill(password);
    await this.signInButton.click();
  }
}
```

#### Using Page Objects in Tests

```typescript
// /frontend/tests/login.spec.ts
import { test, expect } from '@playwright/test';
import { LoginPage } from './pages/LoginPage';

test.describe('Login', () => {
  let loginPage: LoginPage;

  test.beforeEach(async ({ page }) => {
    loginPage = new LoginPage(page);
    await loginPage.goto();
  });

  test('should login successfully with valid credentials', async ({ page }) => {
    await loginPage.login('user@example.com', 'password');
    await expect(page).toHaveURL('/dashboard');
  });

  test('should show error with invalid credentials', async () => {
    await loginPage.login('invalid@example.com', 'wrong');
    await expect(loginPage.errorAlert).toBeVisible();
  });
});
```

#### Page Object Guidelines
1. **One page object per page/component** - Create separate classes for each page
2. **Encapsulate selectors** - All locators should be defined in the page object
3. **Create action methods** - Common user actions should be methods (e.g., `login()`, `submitForm()`)
4. **Keep assertions in tests** - Page objects provide actions, tests make assertions
5. **Reuse across tests** - Import and instantiate page objects in test files

### Test Locations
- E2E tests: `/frontend/tests/*.spec.ts`
- Page Objects: `/frontend/tests/pages/*.ts`
- Playwright config: `/frontend/playwright.config.ts`

### Test Credentials
Use these credentials for authenticated tests:
- Email: `kurochkinslav@gmail.com`
- Password: `admin1234`

## Workflow Reminders

### Before marking a task complete, always:
1. Verify the implementation works as expected
2. Ask: "Would you like me to add Playwright e2e tests for this feature?"
3. If tests were written or exist, ask: "Would you like me to run the Playwright tests now?"

### When user declines tests:
- Acknowledge and proceed without tests
- Do not repeatedly ask for the same feature

## Code Style
- Use TypeScript for Playwright tests
- Use async/await for all browser interactions
- Use meaningful test descriptions
- Group related tests with `test.describe()`
- **ALWAYS use Page Object Model pattern**
